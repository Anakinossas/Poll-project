<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poll - Insert Email</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <style>
        #myBar {
            width: 10%;
            height: 30px;
            background-color: #04AA6D;
            text-align: center; /* To center it horizontally (if you want) */
            line-height: 30px; /* To center it vertically */
            color: white;
            display: none;
        }
    </style>

</head>
<body class="container w-100">

    <div class="row">
        <h1 class="text-center">ZeroPoll</h1>
    </div>

    <div class="row mb-5">
        <div class="col-lg-2 w-25 box shadow rounded-2 p-3">
            <h1 class="text-center">ADMINHO</h1>
        </div>
    </div>

    <div class="row d-flex justify-content-between mt-5">
        <div class="col-lg-2 w-25 box shadow rounded-2 p-3">
            <h4 class="text-center">Load E-Mails</h4>

            <div class="row d-flex justify-content-center align-items-center mb-3">
                <input id="file" name="file" type="file"/>
            </div>
            <div class="row d-flex justify-content-center align-items-center">
                <button type="button" class="btn-success btn w-50" onclick="loadEmails();">
                    Load e-mails
                </button>
            </div>

<!--            <div class="row mt-2" id="myProgress">-->
<!--                <div id="myBar">10%</div>-->
<!--            </div>-->

        </div>

        <div class="col-lg-2 w-25 box shadow rounded-2 p-3">
            <h4 class="text-center">Password Association</h4>
            <div class="row d-flex justify-content-center align-items-center mb-1">
                <p>Give passwords to the emails imported</p>
            </div>
            <div class="row d-flex justify-content-center align-items-center">
                <button type="button" class="btn-success btn w-50" onclick="move()">
                    Give password
                </button>
            </div>

            <div class="row mt-2" id="myProgress">
                <div id="myBar">10%</div>
            </div>

        </div>
    </div>

    <div class="row mt-5 m-auto w-25 text-center">
        <div class="alert alert-success" role="alert" id="alert-success" style="display: none">
            A simple success alert—check it out!
        </div>
    </div>

    <div class="mt-5 m-auto w-25 text-center">
        <div class="alert alert-danger p-4 text-xxl" role="alert" id="alert-danger" style="display: none">
            A simple success alert—check it out!
        </div>
    </div>

    <script>
        function loadEmails()
        {
            move();

            let uploadProdottiField = document.getElementById('file');
            let fileToUpload = uploadProdottiField.files[0];
            let formData = new FormData();

            if(fileToUpload === undefined)
            {
                document.getElementById("alert-danger").style.display="block";
            }
            else
            {
                formData.append("IMPORT_EMAIL", fileToUpload, fileToUpload.filename);
                let httpReq = new XMLHttpRequest();

                httpReq.onreadystatechange = function (evt)
                {
                    if(httpReq.readyState === 4)
                    {
                        if(httpReq.status === 200)
                        {
                            alert('Report Email caricato');
                            document.getElementById("alert-success").style.display="block";
                        }
                        else
                        {
                            console.log(httpReq.responseText);
                            alert('Errore durante il caricamento');
                            document.getElementById("alert-danger").style.display="block";
                        }
                    }
                }

                httpReq.open("POST","http://localhost:8080/api/bo/importEmails");
                httpReq.send(formData);
            }

        }

        function associateEmailWithPassword()
        {
            document.getElementById('alert-danger').style.display="block";
        }

        let i = 0;
        function move() {
            if (i == 0) {
                i = 1;
                let elem = document.getElementById("myBar");
                elem.style.display = "block";

                let width = 10;
                let id = setInterval(frame, 10);
                function frame() {
                    if (width >= 100) {
                        clearInterval(id);
                        associateEmailWithPassword();
                        i = 0;
                    } else {
                        width++;
                        elem.style.width = width + "%";
                        elem.innerHTML = width + "%";
                    }
                }
            }
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
</body>
</html>